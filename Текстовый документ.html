<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="telegram-app-username" content="casinoslavik_bot">
  <title>üöÄ Cosmic Crash</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    window.Telegram = window.Telegram || {};
    window.Telegram.WebApp = window.Telegram.WebApp || {
      ready: () => {}, expand: () => {}, user: { id: 0, first_name: 'Player', username: 'user' },
      themeParams: { bg_color: '#0a0a1a', text_color: '#ffffff', accent_text_color: '#ff5588' }
    };
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body {
      background: linear-gradient(135deg, #0a0a1a, #120f2a);
      color: #e0e6ff;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.3s;
    }
    .app {
      max-width: 560px;
      margin: 0 auto;
      padding: 16px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .logo {
      font-weight: 800;
      font-size: 28px;
      background: linear-gradient(90deg, #ff5588, #00d4ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .user {
      font-size: 14px;
      color: #aaa;
      text-align: right;
    }
    .tabs {
      display: flex;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 6px;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
    }
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab.active {
      background: linear-gradient(135deg, #ff5588, #ff2266);
      color: white;
    }
    .balance-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 85, 136, 0.2);
    }
    .balance-label {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 6px;
    }
    .balance-value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, #ffd700, #ffaa00);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .panel { display: none; }
    .panel.active { display: block; }
    .game-card {
      background: rgba(10, 10, 30, 0.7);
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    .game-header {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title {
      font-size: 20px;
      font-weight: 700;
      color: #00d4ff;
    }
    .graph-area {
      height: 300px;
      background: #080818;
      position: relative;
      overflow: hidden;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    .rocket {
      position: absolute;
      font-size: 28px;
      z-index: 10;
      transition: transform 0.1s;
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.7);
    }
    .flame {
      position: absolute;
      font-size: 16px;
      color: #ff5500;
      animation: flame 0.1s infinite alternate;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
    }
    @keyframes flame {
      from { opacity: 0.7; transform: translateX(-50%) scale(1); }
      to { opacity: 1; transform: translateX(-50%) scale(1.15, 1.4); }
    }
    .controls {
      padding: 20px;
    }
    .input-row {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }
    .input-group {
      flex: 1;
    }
    .label {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    input {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 85, 136, 0.3);
      border-radius: 14px;
      color: white;
      font-size: 18px;
      outline: none;
      font-weight: 600;
    }
    input:focus {
      border-color: #ff5588;
      box-shadow: 0 0 0 3px rgba(255, 85, 136, 0.2);
    }
    .cashout-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #ff5588, #ff2266);
      border: none;
      border-radius: 16px;
      color: white;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 6px 20px rgba(255, 85, 136, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .cashout-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 85, 136, 0.6);
    }
    .cashout-btn:active {
      transform: translateY(1px);
    }
    .cashout-btn:disabled {
      opacity: 0.6;
      transform: none;
      cursor: not-allowed;
    }
    .cashout-icon {
      font-size: 24px;
    }
    .status {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-top: 20px;
      min-height: 32px;
      color: #00d4ff;
    }
    .status.win { color: #00ffaa; }
    .status.lose { color: #ff5555; }
    .clicker-card {
      background: rgba(10, 20, 40, 0.7);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    .click-target {
      width: 180px;
      height: 180px;
      margin: 0 auto 24px;
      background: radial-gradient(circle, #ff5588, #ff2266);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 10px 30px rgba(255, 85, 136, 0.5);
      transition: transform 0.1s;
    }
    .click-target:active {
      transform: scale(0.95);
    }
    .click-value {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .upgrades {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 24px;
    }
    .upgrade-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 16px;
      text-align: left;
    }
    .upgrade-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #00d4ff;
    }
    .upgrade-cost {
      font-size: 14px;
      color: #ffd700;
    }
    .upgrade-btn {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      background: rgba(255, 85, 136, 0.2);
      border: 1px solid rgba(255, 85, 136, 0.3);
      border-radius: 8px;
      color: white;
      cursor: pointer;
    }
    .upgrade-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .admin-console {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 85, 136, 0.3);
    }
    .admin-login-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .admin-input {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 85, 136, 0.3);
      border-radius: 14px;
      color: white;
      font-size: 16px;
      outline: none;
    }
    .admin-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #ff5588, #ff2266);
      border: none;
      border-radius: 14px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    .admin-btn:hover {
      opacity: 0.9;
    }
    .admin-controls {
      display: none;
    }
    .admin-controls.active {
      display: block;
    }
    .admin-commands {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 16px;
    }
    .admin-command-btn {
      padding: 12px;
      background: rgba(255, 85, 136, 0.2);
      border: 1px solid rgba(255, 85, 136, 0.3);
      border-radius: 12px;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    .admin-command-btn:hover {
      background: rgba(255, 85, 136, 0.3);
    }
    .admin-log {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      padding: 12px;
      margin-top: 16px;
      max-height: 150px;
      overflow-y: auto;
      font-size: 14px;
      color: #aaa;
      border: 1px solid rgba(255, 85, 136, 0.2);
    }
    .tg-btn {
      background: linear-gradient(135deg, #0088cc, #00aaff);
      color: white;
      padding: 16px;
      border-radius: 16px;
      font-weight: 700;
      font-size: 18px;
      text-align: center;
      cursor: pointer;
      margin: 20px auto;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 6px 20px rgba(0, 136, 204, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    footer {
      text-align: center;
      padding: 20px 0 10px;
      color: #667;
      font-size: 14px;
    }
    footer a { color: #ff5588; text-decoration: none; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="logo">üöÄ Cosmic</div>
      <div class="user" id="user-info">üë§ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class="balance-card">
      <div class="balance-label">–ë–ê–õ–ê–ù–°</div>
      <div class="balance-value" id="balance">1 000 ‚ÇΩ</div>
    </div>
    <div class="tabs">
      <div class="tab active" data-tab="crash">üöÄ Crash</div>
      <div class="tab" data-tab="clicker">üñ±Ô∏è –ö–ª–∏–∫–µ—Ä</div>
      <div class="tab" data-tab="admin">‚öôÔ∏è –ê–¥–º–∏–Ω</div>
    </div>
    <div class="panel active" id="crash-panel">
      <div class="game-card">
        <div class="game-header">
          <div class="title">CRASH</div>
          <div class="stat-value" id="online-count">1 247</div>
        </div>
        <div class="graph-area">
          <canvas id="graph"></canvas>
          <div class="rocket" id="rocket">üöÄ<div class="flame">üî•</div></div>
        </div>
        <div class="controls">
          <div class="input-row">
            <div class="input-group">
              <div class="label">–°–¢–ê–í–ö–ê</div>
              <input type="number" id="bet" value="100" min="10" max="1000000">
            </div>
          </div>
          <div class="input-row">
            <div class="input-group">
              <div class="label">
                <span>–ê–í–¢–û –ö–≠–®–ê–£–¢</span>
                <span style="color:#00d4ff; font-size:16px;">ü™Ç</span>
              </div>
              <input type="number" id="auto" value="2.50" min="1.01" step="0.01">
            </div>
          </div>
          <button class="cashout-btn" id="play-btn">
            <span class="cashout-icon">ü™Ç</span>
            <span id="btn-text">–°–¢–ê–†–¢</span>
          </button>
          <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ —Å—Ç–∞—Ä—Ç—É</div>
        </div>
      </div>
    </div>
    <div class="panel" id="clicker-panel">
      <div class="clicker-card">
        <div class="click-value">–ó–∞ –∫–ª–∏–∫: <span id="per-click">1</span> ‚ÇΩ</div>
        <div class="click-target" id="click-btn">ü™ô</div>
        <div>–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="total-earned">0</span> ‚ÇΩ</div>
        <div class="upgrades">
          <div class="upgrade-card">
            <div class="upgrade-title">–ê–≤—Ç–æ-–∫–ª–∏–∫</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="auto-speed">0</span>/—Å–µ–∫</div>
            <div class="upgrade-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="auto-cost">500</span> ‚ÇΩ</div>
            <button class="upgrade-btn" id="buy-auto">–£–ª—É—á—à–∏—Ç—å</button>
          </div>
          <div class="upgrade-card">
            <div class="upgrade-title">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
            <div>x<span id="multiplier">1</span></div>
            <div class="upgrade-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="mult-cost">200</span> ‚ÇΩ</div>
            <button class="upgrade-btn" id="buy-mult">–£–ª—É—á—à–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
    <div class="panel" id="admin-panel">
      <div class="admin-console">
        <div class="admin-login-form" id="admin-login-form">
          <input type="password" class="admin-input" id="admin-pass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
          <button class="admin-btn" id="admin-login">–í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å</button>
        </div>
        <div class="admin-controls" id="admin-controls">
          <div class="admin-commands">
            <button class="admin-command-btn" data-cmd="/balance">–ë–∞–ª–∞–Ω—Å</button>
            <button class="admin-command-btn" data-cmd="/add">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="admin-command-btn" data-cmd="/remove">–í—ã—á–µ—Å—Ç—å</button>
            <button class="admin-command-btn" data-cmd="/reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
            <button class="admin-command-btn" data-cmd="/stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="admin-command-btn" data-cmd="/help">–°–ø—Ä–∞–≤–∫–∞</button>
          </div>
          <div class="admin-log" id="admin-log"></div>
        </div>
      </div>
    </div>
    <div class="tg-btn" id="tg-btn">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM16.59 7.58L15.17 6.16L12 9.33L8.83 6.16L7.41 7.58L12 12.17L16.59 7.58Z"/>
      </svg>
      –ò–≥—Ä–∞—Ç—å –≤ Telegram
    </div>
    <footer>
      –î–µ–º–æ. –ê–≤—Ç–æ—Ä: <a href="https://t.me/wwpuq" target="_blank">@wwpuq</a>
    </footer>
  </div>
  <script>
    const BOT_USERNAME = 'casinoslavik_bot';
    const ADMIN_PASS = 'admin123';

    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    
    const tgUser = Telegram.WebApp.initDataUnsafe.user || {};
    const userId = tgUser.id || Date.now();
    const firstName = tgUser.first_name || 'Player';
    const username = tgUser.username || 'user';
    
    document.getElementById('user-info').textContent = `üë§ ${firstName}`;
    
    const theme = Telegram.WebApp.themeParams;
    document.body.style.background = `linear-gradient(135deg, ${theme.bg_color || '#0a0a1a'}, #120f2a)`;

    let balance = parseFloat(localStorage.getItem(`balance_${userId}`)) || 1000;
    let active = false;
    let coef = 1.00;
    let targetCrashPoint = 1.00;
    let startTime = 0;
    let bestCoef = 8.77;

    let perClick = 1;
    let autoSpeed = 0;
    let multiplier = 1;
    let totalEarned = 0;
    let lastAuto = Date.now();

    let isAdmin = false;

    const els = {
      balance: document.getElementById('balance'),
      bet: document.getElementById('bet'),
      auto: document.getElementById('auto'),
      playBtn: document.getElementById('play-btn'),
      status: document.getElementById('status'),
      rocket: document.getElementById('rocket'),
      graph: document.getElementById('graph'),
      btnText: document.getElementById('btn-text'),
      onlineCount: document.getElementById('online-count'),
      tabs: document.querySelectorAll('.tab'),
      panels: document.querySelectorAll('.panel'),
      clickBtn: document.getElementById('click-btn'),
      perClick: document.getElementById('per-click'),
      totalEarned: document.getElementById('total-earned'),
      autoSpeed: document.getElementById('auto-speed'),
      autoCost: document.getElementById('auto-cost'),
      mult: document.getElementById('multiplier'),
      multCost: document.getElementById('mult-cost'),
      buyAuto: document.getElementById('buy-auto'),
      buyMult: document.getElementById('buy-mult'),
      tgBtn: document.getElementById('tg-btn'),
      adminLoginForm: document.getElementById('admin-login-form'),
      adminPass: document.getElementById('admin-pass'),
      adminLogin: document.getElementById('admin-login'),
      adminControls: document.getElementById('admin-controls'),
      adminLog: document.getElementById('admin-log'),
      adminCommandBtns: document.querySelectorAll('.admin-command-btn')
    };

    function saveState() {
      localStorage.setItem(`balance_${userId}`, balance);
      localStorage.setItem(`clicker_${userId}`, JSON.stringify({
        perClick, autoSpeed, multiplier, totalEarned
      }));
    }

    function updateBalance() {
      els.balance.textContent = balance.toLocaleString('ru') + ' ‚ÇΩ';
      els.playBtn.disabled = balance < 10;
      saveState();
    }

    function logAdminAction(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.textContent = `[${timestamp}] ${message}`;
      els.adminLog.appendChild(logEntry);
      els.adminLog.scrollTop = els.adminLog.scrollHeight;
    }

    function adminLogin() {
      if (els.adminPass.value === ADMIN_PASS) {
        isAdmin = true;
        els.adminLoginForm.style.display = 'none';
        els.adminControls.classList.add('active');
        els.adminPass.value = '';
        logAdminAction('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–æ—à—ë–ª –≤ —Å–∏—Å—Ç–µ–º—É');
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
      }
    }

    function adminCommand(cmd) {
      if (!isAdmin) return;
      
      const args = cmd.trim().split(' ');
      const command = args[0].toLowerCase();
      
      switch(command) {
        case '/balance':
          alert(`–ë–∞–ª–∞–Ω—Å: ${balance.toLocaleString('ru')} ‚ÇΩ`);
          logAdminAction('–ó–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞');
          break;
          
        case '/add':
          const addAmount = parseFloat(prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', '1000'));
          if (addAmount && !isNaN(addAmount)) {
            balance += addAmount;
            updateBalance();
            alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${addAmount} ‚ÇΩ`);
            logAdminAction(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addAmount} ‚ÇΩ (–Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${balance})`);
          }
          break;
          
        case '/remove':
          const removeAmount = parseFloat(prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã—á–µ—Ç–∞:', '100'));
          if (removeAmount && !isNaN(removeAmount)) {
            balance = Math.max(0, balance - removeAmount);
            updateBalance();
            alert(`–í—ã—á—Ç–µ–Ω–æ: ${removeAmount} ‚ÇΩ`);
            logAdminAction(`–í—ã—á—Ç–µ–Ω–æ ${removeAmount} ‚ÇΩ (–Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${balance})`);
          }
          break;
          
        case '/reset':
          balance = 1000;
          updateBalance();
          alert('–ë–∞–ª–∞–Ω—Å —Å–±—Ä–æ—à–µ–Ω –¥–æ 1000 ‚ÇΩ');
          logAdminAction('–ë–∞–ª–∞–Ω—Å —Å–±—Ä–æ—à–µ–Ω –¥–æ 1000 ‚ÇΩ');
          break;
          
        case '/stats':
          const stats = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- –ë–∞–ª–∞–Ω—Å: ${balance.toLocaleString('ru')} ‚ÇΩ
- –ó–∞ –∫–ª–∏–∫: ${perClick * multiplier} ‚ÇΩ
- –ê–≤—Ç–æ-–∫–ª–∏–∫: ${autoSpeed.toFixed(1)}/—Å–µ–∫
- –ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${multiplier}
- –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${totalEarned.toLocaleString('ru')} ‚ÇΩ
- –õ—É—á—à–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: ${bestCoef.toFixed(2)}`;
          alert(stats);
          logAdminAction('–ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
          break;
          
        case '/help':
          const helpText = `–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/balance - –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
/add [—Å—É–º–º–∞] - –î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
/remove [—Å—É–º–º–∞] - –í—ã—á–µ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
/reset - –°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å
/stats - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ`;
          alert(helpText);
          logAdminAction('–ó–∞–ø—Ä–æ—Å —Å–ø—Ä–∞–≤–∫–∏');
          break;
          
        default:
          alert('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.');
      }
    }

    const rocketState = {
      x: 40,
      y: 20,
      rotation: 0,
      coef: 1.00,
      lastUpdateTime: 0,
      active: false,
      crashed: false,
      saved: false
    };

    function loadRocketState() {
      const savedState = localStorage.getItem(`rocket_${userId}`);
      if (savedState) {
        const parsed = JSON.parse(savedState);
        rocketState.x = parsed.x;
        rocketState.y = parsed.y;
        rocketState.rotation = parsed.rotation;
        rocketState.coef = parsed.coef;
        rocketState.lastUpdateTime = parsed.lastUpdateTime;
        rocketState.active = parsed.active;
        rocketState.crashed = parsed.crashed;
        rocketState.saved = parsed.saved;
        els.rocket.style.left = `${rocketState.x}px`;
        els.rocket.style.bottom = `${rocketState.y}px`;
        els.rocket.style.transform = `translateX(-50%) rotate(${rocketState.rotation}deg)`;
        coef = rocketState.coef;
        els.status.textContent = `x${coef.toFixed(2)}`;
      }
    }

    function saveRocketState() {
      rocketState.saved = true;
      localStorage.setItem(`rocket_${userId}`, JSON.stringify(rocketState));
    }

    function resetRocketState() {
      rocketState.x = 40;
      rocketState.y = 20;
      rocketState.rotation = 0;
      rocketState.coef = 1.00;
      rocketState.lastUpdateTime = 0;
      rocketState.active = false;
      rocketState.crashed = false;
      rocketState.saved = false;
      els.rocket.style.left = `${rocketState.x}px`;
      els.rocket.style.bottom = `${rocketState.y}px`;
      els.rocket.style.transform = `translateX(-50%)`;
      els.rocket.innerHTML = 'üöÄ<div class="flame">üî•</div>';
    }

    const canvas = els.graph;
    const dpr = window.devicePixelRatio || 1;
    canvas.width = canvas.offsetWidth * dpr;
    canvas.height = canvas.offsetHeight * dpr;
    const ctx = canvas.getContext('2d');
    ctx.scale(dpr, dpr);

    function sound(type) {
      try {
        const ac = new (window.AudioContext || window.webkitAudioContext)();
        const now = ac.currentTime;
        const o = ac.createOscillator();
        const g = ac.createGain();
        o.connect(g);
        g.connect(ac.destination);
        o.frequency.value = type === 'win' ? 900 : type === 'lose' ? 200 : 700;
        g.gain.value = 0.07;
        o.type = 'sine';
        o.start(now);
        o.stop(now + (type === 'lose' ? 0.25 : 0.12));
      } catch (e) {}
    }

    function drawGraph() {
      const w = canvas.offsetWidth;
      const h = canvas.offsetHeight;
      ctx.clearRect(0, 0, w, h);

      const gradient = ctx.createLinearGradient(0, 0, 0, h);
      gradient.addColorStop(0, '#0a0a2a');
      gradient.addColorStop(1, '#050515');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, w, h);

      ctx.fillStyle = 'white';
      for (let i = 0; i < 50; i++) {
        const x = Math.random() * w;
        const y = Math.random() * h;
        const r = Math.random() * 1.5;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
      }

      if (active) {
        ctx.strokeStyle = 'rgba(0, 212, 255, 0.5)';
        ctx.lineWidth = 3;
        ctx.setLineDash([10, 5]);
        ctx.beginPath();
        ctx.moveTo(40, h - 40);
        const t = (performance.now() - startTime) / 1000;
        const c = 1 + Math.pow(t, 1.5);
        const x = 40 + Math.min(1, (c - 1) / 20) * (w - 80);
        const y = h - 40 - Math.min(1, (c - 1) / 20) * (h - 80);
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }

    function animateRocket() {
      if (!active) return;

      const t = (performance.now() - startTime) / 1000;
      coef = 1 + Math.pow(t, 1.5);

      const w = canvas.offsetWidth;
      const h = canvas.offsetHeight;
      const progress = Math.min(1, (coef - 1) / 20);
      const x = 40 + progress * (w - 80);
      const y = h - 40 - progress * (h - 80);
      
      rocketState.x = x;
      rocketState.y = y;
      rocketState.rotation = progress * 15;
      rocketState.coef = coef;
      rocketState.lastUpdateTime = performance.now();
      rocketState.active = true;

      els.rocket.style.left = `${x}px`;
      els.rocket.style.bottom = `${y - 14}px`;
      els.rocket.style.transform = `translateX(-50%) rotate(${rocketState.rotation}deg)`;

      const auto = parseFloat(els.auto.value) || 2.50;
      if (parseFloat(els.auto.value) > 1.00 && coef >= auto) {
        stopRound(true, auto);
        return;
      }

      if (coef >= targetCrashPoint) {
        stopRound(false);
        return;
      }

      els.status.textContent = `x${coef.toFixed(2)}`;
      drawGraph();
      saveRocketState();

      requestAnimationFrame(animateRocket);
    }

    function explode() {
      sound('lose');
      els.rocket.innerHTML = 'üí•';
      rocketState.crashed = true;
      saveRocketState();
      setTimeout(() => {
        els.rocket.innerHTML = 'üöÄ<div class="flame">üî•</div>';
        rocketState.crashed = false;
        resetRocketState();
        saveRocketState();
      }, 500);
    }

    function startRound() {
      const bet = parseFloat(els.bet.value) || 0;
      if (bet < 10 || bet > balance) {
        els.status.textContent = '–ú–∏–Ω. —Å—Ç–∞–≤–∫–∞: 10 ‚ÇΩ';
        els.status.className = 'status lose';
        return;
      }

      balance -= bet;
      updateBalance();

      active = true;
      coef = 1.00;
      startTime = performance.now();
      targetCrashPoint = 1.00 + Math.pow(Math.random(), 2.0) * 5;
      bestCoef = Math.max(bestCoef, targetCrashPoint);

      resetRocketState();
      rocketState.active = true;
      rocketState.lastUpdateTime = startTime;

      els.btnText.textContent = 'ü™Ç –ö–≠–®–ê–£–¢';
      els.playBtn.style.background = 'linear-gradient(135deg, #00d4ff, #00aaff)';
      els.playBtn.style.boxShadow = '0 6px 20px rgba(0, 212, 255, 0.4)';
      els.status.textContent = 'x1.00';
      els.status.className = '';

      sound('start');
      drawGraph();
      requestAnimationFrame(animateRocket);
    }

    function stopRound(won = true, cashout = null) {
      active = false;
      rocketState.active = false;
      const finalCoef = cashout || (won ? coef : targetCrashPoint);
      const bet = parseFloat(els.bet.value);

      if (won) {
        const win = Math.floor(bet * finalCoef);
        balance += win;
        els.status.textContent = `+${win.toLocaleString('ru')} ‚ÇΩ`;
        els.status.className = 'status win';
        sound('win');
      } else {
        explode();
        els.status.textContent = `–í–∑—Ä—ã–≤ –Ω–∞ x${finalCoef.toFixed(2)}`;
        els.status.className = 'status lose';
      }

      updateBalance();
      
      setTimeout(() => {
        resetRocketState();
        saveRocketState();
        els.btnText.textContent = '–°–¢–ê–†–¢';
        els.playBtn.style.background = 'linear-gradient(135deg, #ff5588, #ff2266)';
        els.playBtn.style.boxShadow = '0 6px 20px rgba(255, 85, 136, 0.4)';
        els.status.textContent = '–ì–æ—Ç–æ–≤ –∫ —Å—Ç–∞—Ä—Ç—É';
        els.status.className = '';
      }, 1800);
    }

    function loadClicker() {
      const saved = localStorage.getItem(`clicker_${userId}`);
      if (saved) {
        const data = JSON.parse(saved);
        perClick = data.perClick || 1;
        autoSpeed = data.autoSpeed || 0;
        multiplier = data.multiplier || 1;
        totalEarned = data.totalEarned || 0;
      }
      updateClickerUI();
    }

    function updateClickerUI() {
      els.perClick.textContent = perClick * multiplier;
      els.totalEarned.textContent = totalEarned.toLocaleString('ru');
      els.autoSpeed.textContent = autoSpeed.toFixed(1);
      els.mult.textContent = multiplier;
      els.autoCost.textContent = Math.floor(500 * Math.pow(1.5, autoSpeed)).toLocaleString('ru');
      els.multCost.textContent = Math.floor(200 * Math.pow(1.8, multiplier - 1)).toLocaleString('ru');
      
      els.buyAuto.disabled = balance < parseFloat(els.autoCost.textContent.replace(/\s/g, ''));
      els.buyMult.disabled = balance < parseFloat(els.multCost.textContent.replace(/\s/g, ''));
    }

    function click() {
      const earn = perClick * multiplier;
      balance += earn;
      totalEarned += earn;
      updateBalance();
      updateClickerUI();
      
      els.clickBtn.style.transform = 'scale(0.9)';
      setTimeout(() => els.clickBtn.style.transform = 'scale(1)', 100);
    }

    function buyAuto() {
      const cost = parseFloat(els.autoCost.textContent.replace(/\s/g, ''));
      if (balance >= cost) {
        balance -= cost;
        autoSpeed += 0.5;
        updateBalance();
        updateClickerUI();
      }
    }

    function buyMult() {
      const cost = parseFloat(els.multCost.textContent.replace(/\s/g, ''));
      if (balance >= cost) {
        balance -= cost;
        multiplier += 1;
        updateBalance();
        updateClickerUI();
      }
    }

    setInterval(() => {
      if (autoSpeed > 0) {
        const earn = perClick * multiplier * autoSpeed * 0.1;
        balance += earn;
        totalEarned += earn;
        updateBalance();
      }
    }, 100);

    els.tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        els.tabs.forEach(t => t.classList.remove('active'));
        els.panels.forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-panel').classList.add('active');
      });
    });

    els.playBtn.onclick = () => active ? stopRound(true) : startRound();
    els.clickBtn.onclick = click;
    els.buyAuto.onclick = buyAuto;
    els.buyMult.onclick = buyMult;
    els.adminLogin.onclick = adminLogin;
    
    els.adminCommandBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        adminCommand(btn.dataset.cmd);
      });
    });

    let online = 1200 + Math.floor(Math.random() * 300);
    setInterval(() => {
      online += Math.floor(Math.random() * 10) - 4;
      online = Math.max(800, Math.min(2500, online));
      els.onlineCount.textContent = online.toLocaleString('ru');
    }, 4000);

    els.tgBtn.onclick = () => {
      const url = encodeURIComponent(window.location.href);
      const tgUrl = `https://t.me/${BOT_USERNAME}/app?startapp=crash&url=${url}`;
      if (Telegram.WebApp.initData) {
        Telegram.WebApp.openTelegramLink(tgUrl);
      } else {
        window.open(tgUrl, '_blank');
      }
    };

    if (Telegram.WebApp.initData) {
      els.tgBtn.style.display = 'none';
    }

    loadRocketState();
    updateBalance();
    loadClicker();
    drawGraph();
  </script>
</body>
</html>